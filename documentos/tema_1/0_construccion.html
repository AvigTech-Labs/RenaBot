

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blockly &mdash; documentación de Documentacion_RENA-BOT - 0.1</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=9c9b61ad"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=f85f4cfb"></script>
      <script src="../../_static/tabs.js?v=3030b3cb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Instalacion Arduino ID" href="../tema_2/0_electronica.html" />
    <link rel="prev" title="Introduccion al Repositorio" href="../tema_0/0_intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Documentacion_RENA-BOT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introducción</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tema_0/0_intro.html">Introduccion al Repositorio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Construcción</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Blockly</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sobre-la-version">Sobre la versión</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manejo-del-repositorio-github">Manejo del repositorio GitHub</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ejemplos-basicos">Ejemplos Básicos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#estilo-personalizado">Estilo personalizado</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blockly-websocket-y-excel">Blockly + websocket y Excel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blockly-websocket">Blockly + WebSocket</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Electrónica</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tema_2/0_electronica.html">Instalacion Arduino ID</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tema_3/0_software.html">API Blockly + MQTT</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuración y Uso</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tema_4/0_conf.html">PySide6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tema_4/1_ejemplos.html">HMI - AT-01 kit</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Documentacion_RENA-BOT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Blockly</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="blockly">
<h1>Blockly<a class="headerlink" href="#blockly" title="Link to this heading"></a></h1>
<p>Blockly es un editor de programación visual desarrollado por Google que
utiliza bloques de arrastrar y soltar para representar conceptos de
código.</p>
<p>Es una biblioteca de JavaScript que permite a los desarrolladores
integrar un editor de código basado en bloques en sus aplicaciones.</p>
<p>Blockly es de código abierto y gratuito, y es la base de muchos
programas de aprendizaje de programación populares, como Scratch y
Code.org</p>
<section id="sobre-la-version">
<h2>Sobre la versión<a class="headerlink" href="#sobre-la-version" title="Link to this heading"></a></h2>
<p>La versión que se usa para este repositorio es blockly 11.X, esta
versión es la más estable actualmente y es ampliamente usado en
programas educativos.</p>
<p><a class="reference external" href="https://developers.google.com/blockly/guides/create-custom-blocks/overview?hl=es-419">Repositorio
Oficial</a></p>
<p><a class="reference external" href="https://github.com/google/blockly">GitHub Google</a></p>
<p><a class="reference external" href="https://app.unpkg.com/blockly&#64;11.2.2">Directorio de JS</a></p>
<p><strong>Formas de uso</strong></p>
<p>Al usar el directorio UNPKG, se puede acceder directamente a los
archivos compilados .js</p>
<p>De existir problemas con los archivos existentes en este directorio, se
debe clonar el repositorio GitHub y compilar.</p>
<section id="manejo-del-repositorio-github">
<h3>Manejo del repositorio GitHub<a class="headerlink" href="#manejo-del-repositorio-github" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Clonar el repositorio, con la versión 11.2:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/google/blockly.git
<span class="nb">cd</span><span class="w"> </span>blockly
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Instalar dependencias:</p></li>
</ol>
<p>Instalación de Node.js</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://deb.nodesource.com/setup_18.x<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>bash<span class="w"> </span>-
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs
</pre></div>
</div>
<p><strong>Desinstalacion</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>remove<span class="w"> </span>nodejs
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/etc/apt/sources.list.d/nodesource.list
</pre></div>
</div>
<p>Luego ejecuta:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>install
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Construir (compilar) Blockly:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm<span class="w"> </span>run<span class="w"> </span>build
</pre></div>
</div>
<p>Esto genera la carpeta dist/ con:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dist/
├──<span class="w"> </span>blockly.min.js
├──<span class="w"> </span>blockly_compressed.js
├──<span class="w"> </span>blocks_compressed.js
├──<span class="w"> </span>python_compressed.js
├──<span class="w"> </span>javascript_compressed.js
└──<span class="w"> </span>msg/
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Usarlo en el proyecto:</p></li>
</ol>
<p>Copia los archivos que necesitas desde dist/ a tu carpeta js/ y
enlázalos en tu index.html como:</p>
<script src="js/blockly.min.js"></script><script src="js/python_compressed.js"></script></section>
</section>
<section id="ejemplos-basicos">
<h2>Ejemplos Básicos<a class="headerlink" href="#ejemplos-basicos" title="Link to this heading"></a></h2>
<p>Los siguientes index.html se usan como base para el uso de blockly en
diferentes escenarios.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-MDBfaW5kZXguaHRtbA==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-MDBfaW5kZXguaHRtbA==" name="MDBfaW5kZXguaHRtbA==" role="tab" tabindex="0">00_index.html</button><button aria-controls="panel-0-MDFfaW5kZXguaHRtbA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-MDFfaW5kZXguaHRtbA==" name="MDFfaW5kZXguaHRtbA==" role="tab" tabindex="-1">01_index.html</button></div><div aria-labelledby="tab-0-MDBfaW5kZXguaHRtbA==" class="sphinx-tabs-panel group-tab" id="panel-0-MDBfaW5kZXguaHRtbA==" name="MDBfaW5kZXguaHRtbA==" role="tabpanel" tabindex="0"><p>Descripcion: Genera un código base para el uso de blockly, con el generador de código python y JavaScript.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">Avig Tech 2025</span>
<span class="cm">Generador y ejecutor de bloques Blockly con salida JS + Python</span>
<span class="cm">--&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Blockly v11 - Generador y Ejecutar Código<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Blockly y generadores --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/blockly.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/javascript_compressed.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/python_compressed.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">   </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#f2f5f8</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">blocklyDiv</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#ccc</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">codeArea</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">monospace</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">resize</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">buttons</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#47b881</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nt">button</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#079669</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Blockly v11 - Generar y Ejecutar<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: flex;&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;blocklyDiv&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codeArea&quot;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;buttons&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;generarCodigo()&quot;</span><span class="p">&gt;</span>Generar Código<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;ejecutarCodigo()&quot;</span><span class="p">&gt;</span>Ejecutar JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">   </span><span class="c1">// Bloques personalizados</span>
<span class="w">   </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">defineBlocksWithJsonArray</span><span class="p">([</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;message0&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra %1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;args0&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;input_value&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;TEXTO&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="s2">&quot;previousStatement&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;nextStatement&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;colour&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">160</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;tooltip&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Imprime texto con mensaje especial&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">]);</span>

<span class="w">   </span><span class="c1">// Generadores</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">javascriptGenerator</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">JavaScript</span><span class="p">;</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">pythonGenerator</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Python</span><span class="p">;</span>

<span class="w">   </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">forBlock</span><span class="p">[</span><span class="s1">&#39;printLetra&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">value_texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">.</span><span class="nx">valueToCode</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TEXTO&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">ORDER_ATOMIC</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`console.log(&quot;estoy imprimiendo&quot;, </span><span class="si">${</span><span class="nx">value_texto</span><span class="si">}</span><span class="sb">);\n`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">forBlock</span><span class="p">[</span><span class="s1">&#39;printLetra&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">value_texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">.</span><span class="nx">valueToCode</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TEXTO&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">ORDER_ATOMIC</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`print(&quot;estoy imprimiendo&quot;, </span><span class="si">${</span><span class="nx">value_texto</span><span class="si">}</span><span class="sb">)\n`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="c1">// Toolbox</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">toolbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;flyoutToolbox&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text_print&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;math_number&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="c1">// Workspace</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;blocklyDiv&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">toolbox</span><span class="o">:</span><span class="w"> </span><span class="nx">toolbox</span><span class="p">,</span>
<span class="w">      </span><span class="nx">scrollbars</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">   </span><span class="p">});</span>

<span class="w">   </span><span class="c1">// Función para generar código</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">generarCodigo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigoJS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigoPython</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>

<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s2">&quot;// JavaScript\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">codigoJS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;\n\n# Python\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">codigoPython</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// Función para ejecutar código JavaScript generado</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">ejecutarCodigo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">salida</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// Redirigir console.log</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">salida</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;📤 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Function</span><span class="p">(</span><span class="nx">codigo</span><span class="p">)();</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span>
<span class="w">         </span><span class="s2">&quot;\n// Salida:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">salida</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span>
<span class="w">         </span><span class="s2">&quot;\n// ❌ Error:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalLog</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-MDFfaW5kZXguaHRtbA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-MDFfaW5kZXguaHRtbA==" name="MDFfaW5kZXguaHRtbA==" role="tabpanel" tabindex="0"><p>Descripcion: Ejecuta el codigo generado por blockly</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="cm">&lt;!--</span>
<span class="cm">Avig Tech 2025</span>
<span class="cm">Generador y ejecutor de bloques Blockly con salida JS + Python</span>
<span class="cm">--&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Blockly v11 - Generador y Ejecutar Código<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Blockly y generadores --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/blockly.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/javascript_compressed.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/python_compressed.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">   </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#f2f5f8</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">blocklyDiv</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#ccc</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">codeArea</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">monospace</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">resize</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">buttons</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#47b881</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nt">button</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#079669</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Blockly v11 - Generar y Ejecutar<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: flex;&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;blocklyDiv&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codeArea&quot;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;buttons&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;generarCodigo()&quot;</span><span class="p">&gt;</span>Generar Código<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;ejecutarCodigo()&quot;</span><span class="p">&gt;</span>Ejecutar JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">   </span><span class="c1">// Bloques personalizados</span>
<span class="w">   </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">defineBlocksWithJsonArray</span><span class="p">([</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;message0&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra %1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;args0&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;input_value&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;TEXTO&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="s2">&quot;previousStatement&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;nextStatement&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;colour&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">160</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;tooltip&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Imprime texto con mensaje especial&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">]);</span>

<span class="w">   </span><span class="c1">// Generadores</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">javascriptGenerator</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">JavaScript</span><span class="p">;</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">pythonGenerator</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Python</span><span class="p">;</span>

<span class="w">   </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">forBlock</span><span class="p">[</span><span class="s1">&#39;printLetra&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">value_texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">.</span><span class="nx">valueToCode</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TEXTO&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">ORDER_ATOMIC</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`console.log(&quot;estoy imprimiendo&quot;, </span><span class="si">${</span><span class="nx">value_texto</span><span class="si">}</span><span class="sb">);\n`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">forBlock</span><span class="p">[</span><span class="s1">&#39;printLetra&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">value_texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generator</span><span class="p">.</span><span class="nx">valueToCode</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TEXTO&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">ORDER_ATOMIC</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`print(&quot;estoy imprimiendo&quot;, </span><span class="si">${</span><span class="nx">value_texto</span><span class="si">}</span><span class="sb">)\n`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="c1">// Toolbox</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">toolbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;flyoutToolbox&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;printLetra&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text_print&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">kind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;math_number&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="c1">// Workspace</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;blocklyDiv&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">toolbox</span><span class="o">:</span><span class="w"> </span><span class="nx">toolbox</span><span class="p">,</span>
<span class="w">      </span><span class="nx">scrollbars</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">   </span><span class="p">});</span>

<span class="w">   </span><span class="c1">// Función para generar código</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">generarCodigo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigoJS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigoPython</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pyGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>

<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s2">&quot;// JavaScript\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">codigoJS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;\n\n# Python\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">codigoPython</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// Función para ejecutar código JavaScript generado</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">ejecutarCodigo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsGenerator</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">salida</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">originalLog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// Redirigir console.log</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">salida</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;📤 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Function</span><span class="p">(</span><span class="nx">codigo</span><span class="p">)();</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span>
<span class="w">         </span><span class="s2">&quot;\n// Salida:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">salida</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span>
<span class="w">         </span><span class="s2">&quot;\n// ❌ Error:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalLog</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></div>
<p>Resultado obtenido: <img alt="alt text" src="../../_images/blockly0.png" /></p>
<section id="estilo-personalizado">
<h3>Estilo personalizado<a class="headerlink" href="#estilo-personalizado" title="Link to this heading"></a></h3>
<p>Se puede personlizar el estilo de los bloques y categorías usando
<code class="docutils literal notranslate"><span class="pre">Blockly.Theme.defineTheme</span></code> .</p>
<p>Esto permite tener:</p>
<ul class="simple">
<li><p>Bloques más estilizados y modernos.</p></li>
<li><p>Colores personalizados para categorías.</p></li>
<li><p>Bordes suaves, fuente clara, etc.</p></li>
</ul>
<p>Paso a añadir al script JavaScript</p>
<p>Agrega esto justo antes de Blockly.inject(…) :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>// 1. Definir un tema personalizado con colores, bordes y fuente
const miTemaClaro = Blockly.Theme.defineTheme(&#39;miTemaClaro&#39;, {
  base: Blockly.Themes.Classic,  // Puedes usar &#39;Classic&#39;, &#39;Modern&#39;, etc.
  blockStyles: {
    colour_blocks: {
      colourPrimary: &#39;#4caf50&#39;,
      colourSecondary: &#39;#388e3c&#39;,
      colourTertiary: &#39;#2e7d32&#39;
    },
    logic_blocks: {
      colourPrimary: &#39;#ff9800&#39;
    },
    loop_blocks: {
      colourPrimary: &#39;#03a9f4&#39;
    },
    text_blocks: {
      colourPrimary: &#39;#9c27b0&#39;
    }
  },
  categoryStyles: {
    dashboard_category: {
      colour: &#39;#4caf50&#39;
    }
  },
  componentStyles: {
    workspaceBackgroundColour: &#39;#f3f6fa&#39;,
    toolboxBackgroundColour: &#39;#e0e0e0&#39;,
    toolboxForegroundColour: &#39;#333&#39;,
    flyoutBackgroundColour: &#39;#ffffff&#39;,
    flyoutOpacity: 1,
    scrollbarColour: &#39;#888&#39;
  },
  fontStyle: {
    family: &#39;Verdana, sans-serif&#39;,
    weight: &#39;normal&#39;,
    size: 14
  },
  startHats: false
});
</pre></div>
</div>
<p>Y luego modificar el <code class="docutils literal notranslate"><span class="pre">Blockly.inject(...)</span></code> así:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>const workspace = Blockly.inject(&#39;blocklyDiv&#39;, {
  toolbox: document.getElementById(&#39;toolbox&#39;),
  theme: miTemaClaro,
  scrollbars: true,
  trashcan: true,
  zoom: { controls: true },
  renderer: &quot;zelos&quot;,
  sounds: false
});
</pre></div>
</div>
</section>
<section id="blockly-websocket-y-excel">
<h3>Blockly + websocket y Excel<a class="headerlink" href="#blockly-websocket-y-excel" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pandas</span> <span class="n">websocket</span>
</pre></div>
</div>
<p>versiones de librerías python instaladas:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>libreria</p></th>
<th class="head"><p>version</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Numpy</p></td>
<td><p>2.2.6</p></td>
</tr>
<tr class="row-odd"><td><p>pandas</p></td>
<td><p>2.3.1</p></td>
</tr>
<tr class="row-even"><td><p>Websocket</p></td>
<td><p>0.2.1</p></td>
</tr>
<tr class="row-odd"><td><p>pip install openpyxl</p></td>
<td><p>3.1.5</p></td>
</tr>
</tbody>
</table>
<p>Para utilizar un archivo de configuracion de excel para los diferentes bloques a utilizarse, se
debe seguir los siguientes pasos:</p>
<ol class="arabic simple">
<li><p>Generar un archivo excel que contenga la siguiente informacion:</p></li>
</ol>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Atributo</p></th>
<th class="head"><p>Uso</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>categoria</p></td>
<td><p>Categoria visual</p></td>
</tr>
<tr class="row-odd"><td><p>nombre_categoria</p></td>
<td><p>Nombre de la categoria para blockly</p></td>
</tr>
<tr class="row-even"><td><p>tipo_bloque</p></td>
<td><p>Tipo de bloque</p></td>
</tr>
<tr class="row-odd"><td><p>hat</p></td>
<td><p>Es un bloque de inicio si/no</p></td>
</tr>
<tr class="row-even"><td><p>mensaje0</p></td>
<td><p>Mensaje que se muestra en el bloque</p></td>
</tr>
<tr class="row-odd"><td><p>color</p></td>
<td><p>Definicion de colores</p></td>
</tr>
<tr class="row-even"><td><p>inputs</p></td>
<td><p>Entradas del bloque</p></td>
</tr>
<tr class="row-odd"><td><p>tooltip</p></td>
<td><p>Mensaje de ayuda</p></td>
</tr>
<tr class="row-even"><td><p>codigo_python</p></td>
<td><p>Codigo python que contiene el bloque</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si el bloque es de cabezera eliminar el argumento <code class="docutils literal notranslate"><span class="pre">&quot;previousStatement&quot;:</span> <span class="pre">null</span></code> el archivo
<code class="docutils literal notranslate"><span class="pre">02_bloques.js</span></code> generado</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Ejecutar el archivo <code class="docutils literal notranslate"><span class="pre">02_xlxs_tojs.py</span></code></p></li>
<li><p>Ejecutar el código  <code class="docutils literal notranslate"><span class="pre">02_main.py</span></code></p></li>
<li><p>Ejecutar el código  <code class="docutils literal notranslate"><span class="pre">02_index.html</span></code></p></li>
</ol>
<p><strong>Códigos</strong></p>
<ul class="simple">
<li><p><strong>Código base</strong> <code class="docutils literal notranslate"><span class="pre">02_xlxs_tojs.py</span></code>: Transforma la información generada de los bloques de un archivo .xlxs a un archivo .js</p></li>
<li><p><strong>Código base</strong> <code class="docutils literal notranslate"><span class="pre">02_main.py</span></code>: Habilita un puerto de comunicación para recibir el código generado  por blockly, posteriormente ejecuta el código como un subproceso de python.</p></li>
<li><p><strong>Código base</strong> <code class="docutils literal notranslate"><span class="pre">02_index.html</span></code>: Carga la información de los bloques personalizados, genera el código en python y luego envia ese código usando websocket para que sea ejecutado en segundo plano. No se puede leer la información en forma de retroalimentación en tiempo real.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-MDJfeGx4c190b2pzNA==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-MDJfeGx4c190b2pzNA==" name="MDJfeGx4c190b2pzNA==" role="tab" tabindex="0">02_xlxs_tojs4</button><button aria-controls="panel-1-MDJfYmxvcXVlcw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-MDJfYmxvcXVlcw==" name="MDJfYmxvcXVlcw==" role="tab" tabindex="-1">02_bloques</button><button aria-controls="panel-1-MDJfbWFpbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-MDJfbWFpbg==" name="MDJfbWFpbg==" role="tab" tabindex="-1">02_main</button><button aria-controls="panel-1-MDJfaW5kZXg=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-MDJfaW5kZXg=" name="MDJfaW5kZXg=" role="tab" tabindex="-1">02_index</button></div><div aria-labelledby="tab-1-MDJfeGx4c190b2pzNA==" class="sphinx-tabs-panel group-tab" id="panel-1-MDJfeGx4c190b2pzNA==" name="MDJfeGx4c190b2pzNA==" role="tabpanel" tabindex="0"><p>Descripción: Transforma la información generada de los bloques de un archivo .xlxs a un archivo .js</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Avig Tech 2025</span>

<span class="sd">Descripción:</span>

<span class="sd">Lee un archivo .xlsx que contiene la información de cada bloque a un archivo de</span>
<span class="sd">informacion .js</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;02_bloques.xlsx&quot;</span><span class="p">)</span>
<span class="n">bloques</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">python_gen</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
   <span class="n">cat</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;categoria&quot;</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">cat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bloques</span><span class="p">:</span>
      <span class="n">bloques</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nombre&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;nombre_categoria&quot;</span><span class="p">],</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
            <span class="s2">&quot;bloques&quot;</span><span class="p">:</span> <span class="p">[]</span>
      <span class="p">}</span>

   <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
      <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;input_value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;INPUT</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="p">})</span>

   <span class="n">bloque</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;tipo_bloque&quot;</span><span class="p">],</span>
      <span class="s2">&quot;message0&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mensaje0&quot;</span><span class="p">],</span>
      <span class="s2">&quot;args0&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
      <span class="s2">&quot;previousStatement&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
      <span class="s2">&quot;nextStatement&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
      <span class="s2">&quot;colour&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
      <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;tooltip&quot;</span><span class="p">],</span>
      <span class="s2">&quot;hat&quot;</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;hat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no_aplica&quot;</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;hat&quot;</span><span class="p">],</span>
   <span class="p">}</span>
   <span class="n">bloques</span><span class="p">[</span><span class="n">cat</span><span class="p">][</span><span class="s2">&quot;bloques&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bloque</span><span class="p">)</span>

   <span class="c1"># Python Generator Handling</span>
   <span class="n">python_gen</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;tipo_bloque&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;codigo_python&quot;</span><span class="p">]</span>

<span class="n">contenido_js</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;window.bloquesPersonalizados = </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;categorias&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">bloques</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;python&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">python_gen</span><span class="p">},</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">;&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;02_bloques.js&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contenido_js</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Archivo bloques.js generado correctamente.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-MDJfYmxvcXVlcw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-MDJfYmxvcXVlcw==" name="MDJfYmxvcXVlcw==" role="tabpanel" tabindex="0"><p>Descripción: Ejemplo de los blqoues generados</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>window.bloquesPersonalizados = {
&quot;categorias&quot;: {
   &quot;robot&quot;: {
      &quot;nombre&quot;: &quot;Robot&quot;,
      &quot;color&quot;: &quot;#4caf50&quot;,
      &quot;bloques&quot;: [
      {
         &quot;type&quot;: &quot;conf_pkg&quot;,
         &quot;message0&quot;: &quot;Iniciar &quot;,
         &quot;args0&quot;: [],
         &quot;nextStatement&quot;: null,
         &quot;colour&quot;: &quot;#4caf50&quot;,
         &quot;tooltip&quot;: &quot;Agrega paquetes python&quot;,
         &quot;hat&quot;: &quot;cap&quot;
      },
      {
         &quot;type&quot;: &quot;conf_globales&quot;,
         &quot;message0&quot;: &quot;configurar robot&quot;,
         &quot;args0&quot;: [],
         &quot;previousStatement&quot;: null,
         &quot;nextStatement&quot;: null,
         &quot;colour&quot;: &quot;#ff7f50&quot;,
         &quot;tooltip&quot;: &quot;variables globales&quot;,
         &quot;hat&quot;: null
      },
      {
         &quot;type&quot;: &quot;conf_robot&quot;,
         &quot;message0&quot;: &quot;definir robot %1 %2 %3&quot;,
         &quot;args0&quot;: [
            {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;INPUT1&quot;
            },
            {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;INPUT2&quot;
            },
            {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;INPUT3&quot;
            }
         ],
         &quot;previousStatement&quot;: null,
         &quot;nextStatement&quot;: null,
         &quot;colour&quot;: &quot;#ff7f50&quot;,
         &quot;tooltip&quot;: &quot;nombres del robot&quot;,
         &quot;hat&quot;: null
      }
      ]
   },
   &quot;sensores&quot;: {
      &quot;nombre&quot;: &quot;Sensores&quot;,
      &quot;color&quot;: &quot;#ff7f50&quot;,
      &quot;bloques&quot;: [
      {
         &quot;type&quot;: &quot;def_sensor&quot;,
         &quot;message0&quot;: &quot;actualizar datos del sensor&quot;,
         &quot;args0&quot;: [],
         &quot;previousStatement&quot;: null,
         &quot;nextStatement&quot;: null,
         &quot;colour&quot;: &quot;#ff7f50&quot;,
         &quot;tooltip&quot;: &quot;actualiza los datos del sensor&quot;,
         &quot;hat&quot;: null
      }
      ]
   }
},
&quot;python&quot;: {
   &quot;conf_pkg&quot;: &quot;# carga de paquetes\nimport time\nimport json\nimport paho.mqtt.client as mqtt\nprint(2)&quot;,
   &quot;conf_globales&quot;: &quot;nombre_robot = \&quot;rm1\&quot;\ncamino = []\nestado_recibido = None\nsensores = []&quot;,
   &quot;conf_robot&quot;: &quot;v1 = {i1}\nv2 = {i2}\nV3 = {i3}&quot;,
   &quot;def_sensor&quot;: &quot;Dato = 0.25&quot;
}
};
</pre></div>
</div>
</div><div aria-labelledby="tab-1-MDJfbWFpbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-MDJfbWFpbg==" name="MDJfbWFpbg==" role="tabpanel" tabindex="0"><p>Descripción: Habilita un puerto de comunicación para recibir el código generado  por blockly, posteriormente ejecuta el código como un subproceso de python.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Avig Tech - Versión simplificada</span>

<span class="sd">Descripción:</span>
<span class="sd">Este script lanza un servidor WebSocket en `ws://localhost:5678`</span>
<span class="sd">y espera recibir código Python desde un cliente (por ejemplo, una interfaz Blockly).</span>
<span class="sd">Cuando recibe una acción &quot;ejecutar_python&quot;, ejecuta ese código en un proceso separado.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">try</span><span class="p">:</span>
   <span class="kn">import</span><span class="w"> </span><span class="nn">websockets</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
   <span class="n">websockets</span> <span class="o">=</span> <span class="kc">None</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Módulo websockets no instalado. Instálalo con: pip install websockets&quot;</span><span class="p">)</span>

<span class="c1"># Variable global para controlar el proceso en ejecución</span>
<span class="n">proceso_codigo</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Función que ejecuta el código Python recibido</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ejecutar_codigo</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
   <span class="k">try</span><span class="p">:</span>
      <span class="n">exec</span><span class="p">(</span><span class="n">codigo</span><span class="p">,</span> <span class="p">{})</span>
   <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error ejecutando código:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Función manejadora de WebSocket</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ws_handler</span><span class="p">(</span><span class="n">websocket</span><span class="p">):</span>
   <span class="k">global</span> <span class="n">proceso_codigo</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cliente conectado&quot;</span><span class="p">)</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">websocket</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mensaje recibido: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
               <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
               <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se pudo decodificar el mensaje:&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
               <span class="k">continue</span>

            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accion&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;ejecutar_python&quot;</span><span class="p">:</span>
               <span class="n">codigo</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;codigo&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

               <span class="c1"># Si hay un proceso corriendo, lo detenemos primero</span>
               <span class="k">if</span> <span class="n">proceso_codigo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                  <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                  <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

               <span class="c1"># Creamos un nuevo proceso para ejecutar el nuevo código</span>
               <span class="n">proceso_codigo</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">ejecutar_codigo</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">codigo</span><span class="p">,))</span>
               <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

               <span class="c1"># Enviar confirmación al cliente</span>
               <span class="n">respuesta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accion&quot;</span><span class="p">:</span> <span class="s2">&quot;resultado&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;Código ejecutándose...&quot;</span><span class="p">}</span>
               <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">respuesta</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accion&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;detener_codigo&quot;</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">proceso_codigo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                  <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                  <span class="n">proceso_codigo</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                  <span class="n">proceso_codigo</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="n">respuesta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accion&quot;</span><span class="p">:</span> <span class="s2">&quot;resultado&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;Código detenido.&quot;</span><span class="p">}</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">respuesta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accion&quot;</span><span class="p">:</span> <span class="s2">&quot;resultado&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;No hay código ejecutándose.&quot;</span><span class="p">}</span>

               <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">respuesta</span><span class="p">))</span>

   <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en WebSocket:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># Servidor WebSocket</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ws_server</span><span class="p">():</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iniciando servidor WebSocket en ws://localhost:5678&quot;</span><span class="p">)</span>
   <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">ws_handler</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">5678</span><span class="p">):</span>
      <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>  <span class="c1"># Mantiene el servidor corriendo</span>

<span class="c1"># Punto de entrada</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">websockets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Instala la librería con: pip install websockets&quot;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ws_server</span><span class="p">())</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-MDJfaW5kZXg=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-MDJfaW5kZXg=" name="MDJfaW5kZXg=" role="tabpanel" tabindex="0"><p>Descripción: Carga la información de los bloques personalizados, genera el código en python y luego envia ese código usando websocket para que sea ejecutado en segundo plano. No se puede leer la información en forma de retroalimentación en tiempo real.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Avig Tech Blockly Básico<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Librerías --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/blockly.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/python_compressed.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/blockly/msg/en.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;02_bloques.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Estilos --&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">   </span><span class="nt">html</span><span class="o">,</span><span class="w"> </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">mainContainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">blocklyDiv</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* Botones flotantes */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="o">,</span><span class="w"> </span><span class="p">#</span><span class="nn">executeBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">orange</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">executeBtn</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">160</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#47b881</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">executeBtn</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#079669</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#ff5722</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* Panel deslizante lateral */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">codePanel</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">-50</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-sizing</span><span class="p">:</span><span class="w"> </span><span class="kc">border-box</span><span class="p">;</span>
<span class="w">      </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="kc">right</span><span class="w"> </span><span class="mf">0.3</span><span class="kt">s</span><span class="w"> </span><span class="kc">ease</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">      </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">codePanel</span><span class="p">.</span><span class="nc">open</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">closeCodeBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">orange</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">codeArea</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">flex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">monospace</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#eee</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">resize</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mainContainer&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;blocklyDiv&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

   <span class="cm">&lt;!-- Botones flotantes --&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;toggleCodeBtn&quot;</span><span class="p">&gt;</span><span class="ni">&amp;lt;</span>/<span class="ni">&amp;gt;</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;executeBtn&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;ejecutarCodigoPython()&quot;</span><span class="p">&gt;</span>▶ Ejecutar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

   <span class="cm">&lt;!-- Panel lateral de código --&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codePanel&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;closeCodeBtn&quot;</span><span class="p">&gt;</span>X<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codeArea&quot;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Toolbox dinámico --&gt;</span>
<span class="p">&lt;</span><span class="nt">xml</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;toolbox&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: none&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">xml</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">   </span><span class="c1">// === Construcción de toolbox ===</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">toolbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;toolbox&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">categoriasBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">   &lt;category name=&quot;Entradas&quot; colour=&quot;#9c27b0&quot;&gt;</span>
<span class="sb">      &lt;block type=&quot;math_number&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;text&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;logic_boolean&quot;&gt;&lt;/block&gt;</span>
<span class="sb">   &lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Lógica&quot; categorystyle=&quot;logic_category&quot;&gt;</span>
<span class="sb">      &lt;block type=&quot;controls_if&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;logic_compare&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;logic_operation&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;logic_boolean&quot;&gt;&lt;/block&gt;</span>
<span class="sb">   &lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Variables&quot; categorystyle=&quot;variable_category&quot; custom=&quot;VARIABLE&quot;&gt;&lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Matemáticas&quot; categorystyle=&quot;math_category&quot;&gt;</span>
<span class="sb">      &lt;block type=&quot;math_arithmetic&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;math_number&quot;&gt;&lt;/block&gt;</span>
<span class="sb">   &lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Texto&quot; categorystyle=&quot;text_category&quot;&gt;</span>
<span class="sb">      &lt;block type=&quot;text&quot;&gt;&lt;/block&gt;</span>
<span class="sb">      &lt;block type=&quot;text_print&quot;&gt;&lt;/block&gt;</span>
<span class="sb">   &lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Bucles&quot; categorystyle=&quot;loop_category&quot;&gt;</span>
<span class="sb">      &lt;block type=&quot;controls_repeat_ext&quot;&gt;&lt;/block&gt;</span>
<span class="sb">   &lt;/category&gt;</span>
<span class="sb">   &lt;category name=&quot;Funciones&quot; categorystyle=&quot;procedure_category&quot; custom=&quot;PROCEDURE&quot;&gt;&lt;/category&gt;</span>
<span class="sb">   `</span><span class="p">;</span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">catKey</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">categorias</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">categorias</span><span class="p">[</span><span class="nx">catKey</span><span class="p">];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">catElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">catElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="p">.</span><span class="nx">nombre</span><span class="p">);</span>
<span class="w">      </span><span class="nx">catElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">bloque</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">cat</span><span class="p">.</span><span class="nx">bloques</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">blockElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">blockElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bloque</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="w">      </span><span class="nx">catElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">blockElement</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">catElement</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="s1">&#39;beforeend&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">categoriasBase</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// === Definición de bloques personalizados ===</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">todosBloques</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">catKey</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">categorias</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">bloques</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">categorias</span><span class="p">[</span><span class="nx">catKey</span><span class="p">].</span><span class="nx">bloques</span><span class="p">;</span>
<span class="w">      </span><span class="nx">bloques</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">args0</span><span class="p">)</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">args0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">args0</span><span class="p">));</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="nx">todosBloques</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">bloques</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">defineBlocksWithJsonArray</span><span class="p">(</span><span class="nx">todosBloques</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// === Generadores Python ===</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">pyGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">pythonGenerator</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Python</span><span class="p">;</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">tipo</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">python</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">pyGen</span><span class="p">.</span><span class="nx">forBlock</span><span class="p">[</span><span class="nx">tipo</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bloquesPersonalizados</span><span class="p">.</span><span class="nx">python</span><span class="p">[</span><span class="nx">tipo</span><span class="p">];</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">def</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">todosBloques</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">tipo</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">def</span><span class="o">?</span><span class="p">.</span><span class="nx">args0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">def</span><span class="p">.</span><span class="nx">args0</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pyGen</span><span class="p">.</span><span class="nx">valueToCode</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="sb">`INPUT</span><span class="si">${</span><span class="nx">idx</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Python</span><span class="p">.</span><span class="nx">ORDER_ATOMIC</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="sb">`valor</span><span class="si">${</span><span class="nx">idx</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">            </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">codigo</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="sb">`{i</span><span class="si">${</span><span class="nx">idx</span><span class="si">}</span><span class="sb">}`</span><span class="p">,</span><span class="w"> </span><span class="nx">arg</span><span class="p">);</span>
<span class="w">         </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// === Inicializar Blockly ===</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;blocklyDiv&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">toolbox</span><span class="p">,</span><span class="w"> </span><span class="nx">scrollbars</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">trashcan</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">zoom</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">controls</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">renderer</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;zelos&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Themes</span><span class="p">.</span><span class="nx">Classic</span><span class="p">,</span><span class="w"> </span><span class="nx">sounds</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">   </span><span class="p">});</span>

<span class="w">   </span><span class="c1">// === WebSocket ===</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">conectarWebSocket</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://localhost:5678&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;✅ WebSocket conectado&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">conectarWebSocket</span><span class="p">,</span><span class="w"> </span><span class="mf">2000</span><span class="p">);</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;❌ Error WebSocket&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">accion</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;resultado&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;\n# Resultado:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">output</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;❌ Error en mensaje:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="p">};</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">conectarWebSocket</span><span class="p">();</span>

<span class="w">   </span><span class="c1">// === Funciones Python ===</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">generarCodigoPython</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pyGen</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">codigo</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">ejecutarCodigoPython</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">generarCodigoPython</span><span class="p">();</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ws</span><span class="o">?</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">accion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ejecutar_python&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">codigo</span><span class="w"> </span><span class="p">}));</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;⚠️ WebSocket no está conectado&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// === Mostrar/Ocultar panel lateral ===</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;toggleCodeBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;closeCodeBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></div>
<p>El resultado esperado es el siguiente:
<img alt="bloques per" src="../../_images/bloques_personalizados.png" /></p>
</section>
<section id="blockly-websocket">
<h3>Blockly + WebSocket<a class="headerlink" href="#blockly-websocket" title="Link to this heading"></a></h3>
<p>El siguiente código genera un diccionario que es enviado por WebSocket, se utiliza el puerto 81 para el
envio de mensajes.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-QmxvY2tseS5pbmRleA==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-QmxvY2tseS5pbmRleA==" name="QmxvY2tseS5pbmRleA==" role="tab" tabindex="0">Blockly.index</button><button aria-controls="panel-2-YmxvcXVlcy5qcw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-YmxvcXVlcy5qcw==" name="YmxvcXVlcy5qcw==" role="tab" tabindex="-1">bloques.js</button></div><div aria-labelledby="tab-2-QmxvY2tseS5pbmRleA==" class="sphinx-tabs-panel group-tab" id="panel-2-QmxvY2tseS5pbmRleA==" name="QmxvY2tseS5pbmRleA==" role="tabpanel" tabindex="0"><p>Descripción: Index de blockly para la generacion de bloques personalizados con websocket.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>AVIG TECH - RENA BOT<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;03_libs/blockly.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;03_libs/interact.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;03_libs/bloques.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  <span class="cm">&lt;!-- Libreria personalizada --&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">   </span><span class="nt">html</span><span class="o">,</span><span class="w"> </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* BARRA SUPERIOR */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">topbar</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span><span class="w"> </span><span class="kc">right</span><span class="p">,</span><span class="w"> </span><span class="mh">#feb328</span><span class="p">,</span><span class="w"> </span><span class="mh">#faa200</span><span class="p">);</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">      </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">      </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">space-between</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">topbar</span><span class="w"> </span><span class="p">.</span><span class="nc">title</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropdown</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropbtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropdown-content</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">min-width</span><span class="p">:</span><span class="w"> </span><span class="mi">180</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropdown-content</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropdown-content</span><span class="w"> </span><span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#eeeeee</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">dropdown</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">.</span><span class="nc">dropdown-content</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">mainContainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">vh</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="kt">px</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">blocklyDiv</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* BOTONES CÓDIGO Y EJECUTAR */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="o">,</span><span class="w"> </span><span class="p">#</span><span class="nn">runBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w">  </span><span class="mi">2</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#ffa500</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">      </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="k">background-color</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="w"> </span><span class="kc">ease</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mf">7.2</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="p">#</span><span class="nn">runBtn</span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">runBtn</span><span class="p">:</span><span class="nd">active</span><span class="o">,</span><span class="w">  </span><span class="p">#</span><span class="nn">toggleCodeBtn</span><span class="p">:</span><span class="nd">active</span><span class="p">{</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#cc8400</span><span class="p">;</span><span class="w"> </span><span class="c">/* un tono más oscuro de naranja */</span>
<span class="w">      </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">scale</span><span class="p">(</span><span class="mf">0.97</span><span class="p">);</span><span class="w"> </span><span class="c">/* opcional: efecto presionado */</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* PANEL DE CODIGO */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">codePanel</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"> </span><span class="c">/* 👈 totalmente oculto por defecto */</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-sizing</span><span class="p">:</span><span class="w"> </span><span class="kc">border-box</span><span class="p">;</span>
<span class="w">      </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="kc">all</span><span class="w"> </span><span class="mf">0.3</span><span class="kt">s</span><span class="w"> </span><span class="kc">ease</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">      </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">codePanel</span><span class="p">.</span><span class="nc">open</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span><span class="w"> </span><span class="c">/* 👈 solo se muestra con esta clase */</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">codeArea</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">flex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">monospace</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#181824</span><span class="p">;</span>
<span class="w">      </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#eee</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">resize</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* Configuracion Html  Area de sensores*/</span>

<span class="w">   </span><span class="p">#</span><span class="nn">togglegraficarBtn</span><span class="o">,</span><span class="w"> </span><span class="p">#</span><span class="nn">graficarBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#ffa500</span><span class="p">;</span>
<span class="w">      </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">      </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="k">background-color</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="w"> </span><span class="kc">ease</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">togglegraficarBtn</span><span class="p">:</span><span class="nd">active</span><span class="o">,</span><span class="w">  </span><span class="p">#</span><span class="nn">graficarBtn</span><span class="p">:</span><span class="nd">active</span><span class="p">{</span>
<span class="w">      </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#cc8400</span><span class="p">;</span><span class="w"> </span><span class="c">/* un tono más oscuro de naranja */</span>
<span class="w">      </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">scale</span><span class="p">(</span><span class="mf">0.97</span><span class="p">);</span><span class="w"> </span><span class="c">/* opcional: efecto presionado */</span>
<span class="w">   </span><span class="p">}</span>


<span class="w">   </span><span class="p">#</span><span class="nn">togglegraficarBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mf">7.2</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">graficarBtn</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">%</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c">/* PANEL DE GRAFICOS SENSORES */</span>
<span class="w">   </span><span class="p">#</span><span class="nn">GraficoPanel</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"> </span><span class="c">/* 👈 totalmente oculto por defecto */</span>
<span class="w">      </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">      </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#f3f3f3</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-sizing</span><span class="p">:</span><span class="w"> </span><span class="kc">border-box</span><span class="p">;</span>
<span class="w">      </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="kc">all</span><span class="w"> </span><span class="mf">0.3</span><span class="kt">s</span><span class="w"> </span><span class="kc">ease</span><span class="p">;</span>
<span class="w">      </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">      </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>


<span class="w">   </span><span class="p">#</span><span class="nn">GraficoPanel</span><span class="p">.</span><span class="nc">open</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span><span class="w"> </span><span class="c">/* 👈 solo se muestra con esta clase */</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">#</span><span class="nn">sensorDashboard</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">flex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">      </span><span class="k">flex-wrap</span><span class="p">:</span><span class="w"> </span><span class="kc">wrap</span><span class="p">;</span>
<span class="w">      </span><span class="k">gap</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>


<span class="w">   </span><span class="p">.</span><span class="nc">grafico</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">250</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">      </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">      </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
<span class="w">      </span><span class="k">resize</span><span class="p">:</span><span class="w"> </span><span class="kc">both</span><span class="p">;</span>
<span class="w">      </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="p">.</span><span class="nc">gauge-box</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">      </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- BARRA SUPERIOR --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;topbar&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>AVIG TECH | Blockly<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dropdown&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dropbtn&quot;</span><span class="p">&gt;</span>⚙️ Opciones<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dropdown-content&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;guardarWorkspace()&quot;</span><span class="p">&gt;</span>💾 Guardar bloques<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;document.getElementById(&#39;inputArchivo&#39;).click()&quot;</span><span class="p">&gt;</span>📥 Cargar bloques<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;inputArchivo&quot;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&quot;.xml&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display:none&quot;</span> <span class="na">onchange</span><span class="o">=</span><span class="s">&quot;cargarWorkspace(event)&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mainContainer&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;blocklyDiv&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codePanel&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;codeArea&quot;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

   <span class="cm">&lt;!-- Botones Código --&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;toggleCodeBtn&quot;</span><span class="p">&gt;</span>Código<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;runBtn&quot;</span><span class="p">&gt;</span>▶️<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="cm">&lt;!-- Botones Sensores --&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;togglegraficarBtn&quot;</span><span class="p">&gt;</span>Sensores<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;graficarBtn&quot;</span><span class="p">&gt;</span>▶️<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;GraficoPanel&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;modoMoverBtn&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin-bottom: 10px; width: fit-content;&quot;</span><span class="p">&gt;</span>🖱️ Modo mover<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;sensorDashboard&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- TOOLBOX DEFINIDO --&gt;</span>
<span class="p">&lt;</span><span class="nt">xml</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;toolbox&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: none&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">category</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Rena 1&quot;</span> <span class="na">colour</span><span class="o">=</span><span class="s">&quot;#f19f10&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_inicar&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;modo_rena&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_velocidad&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;avance_libre&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;giro_libre&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_gripper&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_esperar&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_led&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>

   <span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">category</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Sensores&quot;</span> <span class="na">colour</span><span class="o">=</span><span class="s">&quot;#f19f10&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_leer_sensor&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;get_sensor&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">category</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Valores&quot;</span> <span class="na">colour</span><span class="o">=</span><span class="s">&quot;#2777c3&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;math_number&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;logic_boolean&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">category</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Control&quot;</span> <span class="na">colour</span><span class="o">=</span><span class="s">&quot;#2fa92f&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_if&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_for&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;bloque_if_else&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">category</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Lógica&quot;</span> <span class="na">colour</span><span class="o">=</span><span class="s">&quot;#2196f3&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;logic_compare&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;logic_operation&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">block</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;logic_boolean&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">block</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">category</span><span class="p">&gt;</span>

   <span class="cm">&lt;!--</span>
<span class="cm">   &lt;category name=&quot;Variables&quot; colour=&quot;#ba68c8&quot;&gt;</span>
<span class="cm">      &lt;block type=&quot;crear_variable&quot;&gt;&lt;/block&gt;</span>
<span class="cm">      &lt;block type=&quot;set_variable&quot;&gt;&lt;/block&gt;</span>
<span class="cm">      &lt;block type=&quot;get_variable&quot;&gt;&lt;/block&gt;</span>
<span class="cm">   &lt;/category&gt; --&gt;</span>
<span class="p">&lt;/</span><span class="nt">xml</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;blocklyDiv&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">toolbox</span><span class="o">:</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;toolbox&#39;</span><span class="p">),</span>
<span class="w">   </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Theme</span><span class="p">.</span><span class="nx">defineTheme</span><span class="p">(</span><span class="s1">&#39;miTemaClaro&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">base</span><span class="o">:</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Themes</span><span class="p">.</span><span class="nx">Classic</span><span class="p">,</span>
<span class="w">      </span><span class="nx">fontStyle</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">14</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">}),</span>
<span class="w">   </span><span class="nx">scrollbars</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">   </span><span class="nx">trashcan</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">   </span><span class="nx">zoom</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">controls</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span>
<span class="w">   </span><span class="nx">renderer</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;zelos&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nx">sounds</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">});</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">conectarWebSocket</span><span class="p">(</span><span class="nx">ip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">wsURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`ws://</span><span class="si">${</span><span class="nx">ip</span><span class="si">}</span><span class="sb">:81`</span><span class="p">;</span><span class="w">  </span><span class="c1">// puerto WebSocket por defecto en ESP32</span>
<span class="w">   </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="nx">wsURL</span><span class="p">);</span>

<span class="w">   </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;✅ WebSocket conectado a&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">wsURL</span><span class="p">);</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`\n\n✅ Conectado a </span><span class="si">${</span><span class="nx">wsURL</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;❌ Error WebSocket:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`\n\n❌ Error de WebSocket: </span><span class="si">${</span><span class="nx">err</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;📨 Mensaje recibido:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;\n\n📨 Respuesta: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">   </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">ejecutarComandos</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">jsonGen</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">   </span><span class="nx">jsonGen</span><span class="p">.</span><span class="nx">commands_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">   </span><span class="nx">jsonGen</span><span class="p">.</span><span class="nx">workspaceToCode</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">comandos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsonGen</span><span class="p">.</span><span class="nx">commands_</span><span class="p">;</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsonGen</span><span class="p">.</span><span class="nx">ip</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;192.168.4.1&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// IP por defecto si usas AP local</span>

<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">comandos</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Conectar WebSocket si aún no lo está</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">ws</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">ws</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">conectarWebSocket</span><span class="p">(</span><span class="nx">ip</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Esperar conexión antes de enviar</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">intervalo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ws</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalo</span><span class="p">);</span>
<span class="w">            </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">comandos</span><span class="w"> </span><span class="p">}));</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;\n\n🚀 Comandos enviados vía WebSocket&quot;</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codeArea&quot;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;\n\n❌ Error al enviar comandos: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">guardarWorkspace</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Xml</span><span class="p">.</span><span class="nx">workspaceToDom</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Xml</span><span class="p">.</span><span class="nx">domToPrettyText</span><span class="p">(</span><span class="nx">xml</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nx">texto</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/xml&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>

<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">a</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
<span class="w">   </span><span class="nx">a</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mis_bloques.xml&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
<span class="w">   </span><span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">cargarWorkspace</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">file</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileReader</span><span class="p">();</span>
<span class="w">   </span><span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">xml</span><span class="p">.</span><span class="nx">textToDom</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
<span class="w">      </span><span class="nx">Blockly</span><span class="p">.</span><span class="nx">Xml</span><span class="p">.</span><span class="nx">domToWorkspace</span><span class="p">(</span><span class="nx">xml</span><span class="p">,</span><span class="w"> </span><span class="nx">workspace</span><span class="p">);</span>
<span class="w">   </span><span class="p">};</span>
<span class="w">   </span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsText</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c1">// --- Botones laterales ---</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;togglegraficarBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">graficoPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;GraficoPanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">codePanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">graficoPanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">codePanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;graficarBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">graficar</span><span class="p">();</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">graficoPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;GraficoPanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">codePanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">graficoPanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">codePanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;toggleCodeBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">codePanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">graficoPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;GraficoPanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">codePanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">graficoPanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;runBtn&quot;</span><span class="p">).</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">ejecutarComandos</span><span class="p">();</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">codePanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;codePanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">graficoPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;GraficoPanel&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">codePanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">graficoPanel</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-YmxvcXVlcy5qcw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-YmxvcXVlcy5qcw==" name="YmxvcXVlcy5qcw==" role="tabpanel" tabindex="0"><p>Descripción: Lista de bloques y algoritmos para la generacion de bloques.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>// Geneneración de bloques

Blockly.defineBlocksWithJsonArray([

// -------------------- Bloques Principales ----------------------------------
      // Bloque Iniciar el Robot
   {
      &quot;type&quot;: &quot;bloque_inicar&quot;,
      &quot;message0&quot;: &quot;Iniciar kit de robótica %1 IP del servidor %2&quot;,
      &quot;args0&quot;: [
            { &quot;type&quot;: &quot;field_input&quot;, &quot;name&quot;: &quot;NOMBRE&quot;, &quot;text&quot;: &quot;Rena1&quot; },
            { &quot;type&quot;: &quot;field_input&quot;, &quot;name&quot;: &quot;IP&quot;, &quot;text&quot;: &quot;192.168.100.184&quot; }
         ],
      &quot;hat&quot;: &quot;cap&quot;,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: &quot;#f19f10&quot;,
      &quot;tooltip&quot;: &quot;Iniciar Rena Robot&quot;
   },

   // Bloque movimiento RENA en malla
   {
      &quot;type&quot;: &quot;modo_rena&quot;,
      &quot;message0&quot;: &quot;Mover Robot Movil %1&quot;,
      &quot;args0&quot;: [
                  {
                  &quot;type&quot;: &quot;field_dropdown&quot;,
                  &quot;name&quot;: &quot;MOV&quot;,
                  &quot;options&quot;: [
                        [&quot;adelante&quot;, &quot;0&quot;],
                        [&quot;izquierda&quot;, &quot;1&quot;],
                        [&quot;derecha&quot;, &quot;2&quot;],
                        [&quot;atras&quot;, &quot;3&quot;]
                  ]
                  },
                  ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Activa los movimientos del RENA en la malla&quot;
   },

   // Avance Libre
   {
      &quot;type&quot;: &quot;avance_libre&quot;,
      &quot;message0&quot;: &quot;Modo libre %1 durate %2 segundos&quot;,
      &quot;args0&quot;: [
                  {
                  &quot;type&quot;: &quot;field_dropdown&quot;,
                  &quot;name&quot;: &quot;VALOR&quot;,
                  &quot;options&quot;: [
                        [&quot;adelante&quot;, &quot;0&quot;],
                        [&quot;retroceder&quot;, &quot;1&quot;]
                  ]
                  },
                  { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;TIME&quot;, &quot;check&quot;: &quot;Number&quot; },
                  ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Controla el avance del RENA Bot durante x segundos&quot;
   },

   //  Giro libre
   {
      &quot;type&quot;: &quot;giro_libre&quot;,
      &quot;message0&quot;: &quot;Modo libre %1 durate %2 segundos&quot;,
      &quot;args0&quot;: [
                  {
                  &quot;type&quot;: &quot;field_dropdown&quot;,
                  &quot;name&quot;: &quot;VALOR&quot;,
                  &quot;options&quot;: [
                        [&quot;giro izquierda&quot;, &quot;0&quot;],
                        [&quot;giro derecha&quot;, &quot;1&quot;]
                  ]
                  },
                  { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;TIME&quot;, &quot;check&quot;: &quot;Number&quot; },
                  ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Controla el giro del RENA Bot durante x segundos&quot;
   },

   // Bloque Esperar
   {
      &quot;type&quot;: &quot;bloque_esperar&quot;,
      &quot;message0&quot;: &quot;Esperar  %1 segundos&quot;,
         &quot;args0&quot;: [
            { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;TIME&quot;, &quot;check&quot;: &quot;Number&quot; },
                  ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Espera una cantidad de tiempo&quot;
   },

   // Bloque modificar velocidad
   {
      &quot;type&quot;: &quot;bloque_velocidad&quot;,
      &quot;message0&quot;: &quot;Velocidad %1 porcentaje&quot;,
      &quot;args0&quot;: [
               { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;VELOCIDAD&quot;, &quot;check&quot;: &quot;Number&quot; }
               ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Define la velocidad a la que se mueve el robot&quot;
   },

   // Bloque activar el gripper
   {
      &quot;type&quot;: &quot;bloque_gripper&quot;,
      &quot;message0&quot;: &quot;Gripper %1&quot;,
      &quot;args0&quot;: [
            {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;GRIPPER&quot;,
            &quot;options&quot;: [
               [&quot;Abrir&quot;, &quot;1&quot;],
               [&quot;Cerrar&quot;, &quot;0&quot;],
            ]
            },
               ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Cambiar el estado del gripper&quot;
   },

   // Bloque Encender LEDs
   {
      &quot;type&quot;: &quot;bloque_led&quot;,
      &quot;message0&quot;: &quot;LED %1&quot;,
      &quot;args0&quot;: [
            {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;LED&quot;,
            &quot;options&quot;: [
               [&quot;ON&quot;, &quot;1&quot;],
               [&quot;OFF&quot;, &quot;0&quot;],
            ]
            },
               ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 230,
      &quot;tooltip&quot;: &quot;Encender LEDS&quot;
   },

   //  ------------------------------ Bloque condicionales -------------------
   // Bloque condicional IF
   {
      &quot;type&quot;: &quot;bloque_if&quot;,
      &quot;message0&quot;: &quot;si %1 entonces %2&quot;,
      &quot;args0&quot;: [
            {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;VAR&quot;,  // recibe expresiones booleanas como output: &quot;Boolean&quot;
            &quot;check&quot;: &quot;Boolean&quot;
            },
            {
            &quot;type&quot;: &quot;input_statement&quot;,
            &quot;name&quot;: &quot;ENTONCES&quot;
            }
      ],
      &quot;colour&quot;: 120,
      &quot;tooltip&quot;: &quot;Evalúa una condición lógica y ejecuta si se cumple&quot;,
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null
   },

   // Bloque For
   {
      &quot;type&quot;: &quot;bloque_for&quot;,
      &quot;message0&quot;: &quot;repetir %1 veces %2 hacer %3&quot;,
      &quot;args0&quot;: [
            { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;VECES&quot;, &quot;check&quot;: &quot;Number&quot; },
            { &quot;type&quot;: &quot;input_dummy&quot; },
            { &quot;type&quot;: &quot;input_statement&quot;, &quot;name&quot;: &quot;HACER&quot; }
      ],
      &quot;colour&quot;:120,
      &quot;tooltip&quot;: &quot;Repite instrucciones varias veces&quot;,
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null
   },

   // BLoque Comparación entre variables
   {
      &quot;type&quot;: &quot;logic_compare&quot;,
      &quot;message0&quot;: &quot;%1 %2 %3&quot;,
      &quot;args0&quot;: [
      { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;A&quot;, &quot;check&quot;: &quot;Number&quot; },
      {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;OP&quot;,
            &quot;options&quot;: [
            [&quot;=&quot;, &quot;==&quot;],
            [&quot;≠&quot;, &quot;!=&quot;],
            [&quot;<span class="err">&lt;</span>&quot;, &quot;<span class="err">&lt;</span>&quot;],
            [&quot;≤&quot;, &quot;<span class="err">&lt;</span>=&quot;],
            [&quot;&gt;&quot;, &quot;&gt;&quot;],
            [&quot;≥&quot;, &quot;&gt;=&quot;]
            ]
      },
      { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;B&quot;, &quot;check&quot;: &quot;Number&quot; }
      ],
      &quot;inputsInline&quot;: true,
      &quot;output&quot;: &quot;Boolean&quot;,
      &quot;colour&quot;: 210,
      &quot;tooltip&quot;: &quot;Compara dos valores numéricos&quot;
   },

   // Bloque condicional entre IFs
   {
      &quot;type&quot;: &quot;logic_operation&quot;,
      &quot;message0&quot;: &quot;%1 %2 %3&quot;,
      &quot;args0&quot;: [
      {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;A&quot;,
            &quot;check&quot;: &quot;Boolean&quot;
      },
      {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;OP&quot;,
            &quot;options&quot;: [[&quot;y&quot;, &quot;AND&quot;], [&quot;o&quot;, &quot;OR&quot;]]
      },
      {
            &quot;type&quot;: &quot;input_value&quot;,
            &quot;name&quot;: &quot;B&quot;,
            &quot;check&quot;: &quot;Boolean&quot;
      }
      ],
      &quot;inputsInline&quot;: true,
      &quot;output&quot;: &quot;Boolean&quot;,
      &quot;colour&quot;: 210,
      &quot;tooltip&quot;: &quot;Operador lógico AND/OR&quot;
   },

   // Bloque If/Else
   {
      &quot;type&quot;: &quot;bloque_if_else&quot;,
      &quot;message0&quot;: &quot;si %1 entonces %2 si no %3&quot;,
      &quot;args0&quot;: [
      { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;COND&quot;, &quot;check&quot;: &quot;Boolean&quot; },
      { &quot;type&quot;: &quot;input_statement&quot;, &quot;name&quot;: &quot;ENTONCES&quot; },
      { &quot;type&quot;: &quot;input_statement&quot;, &quot;name&quot;: &quot;SINO&quot; }
      ],
      &quot;previousStatement&quot;: null,
      &quot;nextStatement&quot;: null,
      &quot;colour&quot;: 120,
      &quot;tooltip&quot;: &quot;Si la condición se cumple, hace algo; si no, otra cosa.&quot;
   },

   // Bloque Booleano
   {
      &quot;type&quot;: &quot;logic_boolean&quot;,
      &quot;message0&quot;: &quot;%1&quot;,
      &quot;args0&quot;: [
      {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;BOOL&quot;,
            &quot;options&quot;: [[&quot;verdadero&quot;, &quot;True&quot;], [&quot;falso&quot;, &quot;False&quot;]]
      }
      ],
      &quot;output&quot;: &quot;Boolean&quot;,
      &quot;colour&quot;: 210,
      &quot;tooltip&quot;: &quot;Devuelve verdadero o falso&quot;
   },

   // ------------------------------ Bloques de variables propias --------------
   // Bloque crear variable
   {
   &quot;type&quot;: &quot;crear_variable&quot;,
   &quot;message0&quot;: &quot;crear variable %1 con valor %2&quot;,
   &quot;args0&quot;: [
      { &quot;type&quot;: &quot;field_input&quot;, &quot;name&quot;: &quot;NOMBRE&quot;, &quot;text&quot;: &quot;mi_variable&quot; },
      { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;VALOR&quot; }
   ],
   &quot;previousStatement&quot;: null,
   &quot;nextStatement&quot;: null,
   &quot;colour&quot;: 290,
   &quot;tooltip&quot;: &quot;Crea una nueva variable con valor inicial&quot;
   },

   //  BLoque modificar variables
   {
   &quot;type&quot;: &quot;set_variable&quot;,
   &quot;message0&quot;: &quot;establecer %1 a %2&quot;,
   &quot;args0&quot;: [
      { &quot;type&quot;: &quot;field_input&quot;, &quot;name&quot;: &quot;NOMBRE&quot;, &quot;text&quot;: &quot;mi_variable&quot; },
      { &quot;type&quot;: &quot;input_value&quot;, &quot;name&quot;: &quot;VALOR&quot; }
   ],
   &quot;previousStatement&quot;: null,
   &quot;nextStatement&quot;: null,
   &quot;colour&quot;: 290,
   &quot;tooltip&quot;: &quot;Asigna un nuevo valor a una variable&quot;
   },

   // Bloque Obtener variable
   {
   &quot;type&quot;: &quot;get_variable&quot;,
   &quot;message0&quot;: &quot;valor de %1&quot;,
   &quot;args0&quot;: [
      { &quot;type&quot;: &quot;field_input&quot;, &quot;name&quot;: &quot;NOMBRE&quot;, &quot;text&quot;: &quot;mi_variable&quot; }
   ],
   &quot;output&quot;: null,
   &quot;colour&quot;: 290,
   &quot;tooltip&quot;: &quot;Obtiene el valor actual de la variable&quot;
   },

   // ---------------------------Bloques de sensores-----------------------
   // Bloque leer dato del sensor
   {
   &quot;type&quot;: &quot;bloque_leer_sensor&quot;,
   &quot;message0&quot;: &quot;Leer el sensor %1&quot;,
   &quot;args0&quot;: [
            {
            &quot;type&quot;: &quot;field_dropdown&quot;,
            &quot;name&quot;: &quot;SENSOR&quot;,
            &quot;options&quot;: [
               [&quot;ultrasonico&quot;, &quot;ultrasonico&quot;],
               [&quot;LDR&quot;, &quot;LDR&quot;],
            ]
            },
   ],
   &quot;previousStatement&quot;: null,
   &quot;nextStatement&quot;: null,
   &quot;colour&quot;: 290,
   &quot;tooltip&quot;: &quot;Actualiza el valor de un sensor&quot;
   },

   // Variable de sensor
   {
   &quot;type&quot;: &quot;get_sensor&quot;,
   &quot;message0&quot;: &quot;sensor %1&quot;,
   &quot;args0&quot;: [
      {
      &quot;type&quot;: &quot;field_input&quot;,
      &quot;name&quot;: &quot;NUM&quot;,
      &quot;text&quot;: &quot;ultrasonico&quot;
      }
   ],
   &quot;output&quot;: &quot;Number&quot;,  // o &quot;String&quot; si es texto, o null si es genérico
   &quot;colour&quot;: 290,
   &quot;tooltip&quot;: &quot;Devuelve el nombre de la variable para usar en comparaciones&quot;
}
   ]);

// Generadores de bloques

   const jsonGen = new Blockly.Generator(&quot;JSON&quot;);
   jsonGen.ORDER_ATOMIC = 0;

   jsonGen.init = function(workspace) {
      jsonGen.commands_ = [];
   };

   jsonGen.scrub_ = function(block, code) {
      const next = block.getNextBlock();
      if (next) jsonGen.blockToCode(next);
      return block.outputConnection ? code : &quot;&quot;;
   };

//  -------------------------------------- GENERACION DE BLOQUES ----------------------

// ---------------------------------------- Bloques principales -----------------------
// Generador bloque iniciar
   jsonGen.forBlock[&#39;bloque_inicar&#39;] = function(block) {
      const nombre = block.getFieldValue(&quot;NOMBRE&quot;);
      const ip = block.getFieldValue(&quot;IP&quot;);
      jsonGen.ip = ip;  // <span class="p">&lt;</span><span class="nt">--</span> <span class="na">Guardamos</span> <span class="na">la</span> <span class="na">IP</span> <span class="na">para</span> <span class="na">uso</span> <span class="na">global</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">iniciar</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span><span class="na">nombre</span><span class="err">},</span>
      <span class="na">ip</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

<span class="err">//</span> <span class="na">Movimientos</span> <span class="na">del</span> <span class="na">RENA</span> <span class="na">en</span> <span class="na">malla</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">modo_rena</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;MOV&quot;);</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">modo_rena</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span> <span class="na">valor</span> <span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

<span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">de</span> <span class="na">Avance</span> <span class="na">libre</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">avance_libre</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
   <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;VALOR&quot;);</span>

   <span class="na">let</span> <span class="na">timer </span><span class="o">=</span> <span class="s">0;</span>
   <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;TIME&quot;);</span>
   <span class="na">if</span> <span class="err">(</span><span class="na">b</span> <span class="err">&amp;&amp;</span> <span class="na">b</span><span class="err">.</span><span class="na">type </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">math_number</span><span class="err">&#39;)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">raw </span><span class="o">=</span> <span class="s">b.getFieldValue(&#39;NUM&#39;);</span>
      <span class="na">const</span> <span class="na">num </span><span class="o">=</span> <span class="s">parseFloat(raw);</span>
      <span class="na">if</span> <span class="err">(!</span><span class="na">isNaN</span><span class="err">(</span><span class="na">num</span><span class="err">))</span> <span class="err">{</span>
      <span class="err">//</span> <span class="na">Redondear</span> <span class="na">a</span> <span class="na">máximo</span> <span class="na">3</span> <span class="na">decimales</span>
      <span class="na">timer </span><span class="o">=</span> <span class="s">Math.round(num</span> <span class="err">*</span> <span class="na">1000</span><span class="err">)</span> <span class="err">/</span> <span class="na">1000</span><span class="err">;</span>

      <span class="err">//</span> <span class="na">Asegurar</span> <span class="na">que</span> <span class="na">tenga</span> <span class="na">al</span> <span class="na">menos</span> <span class="na">1</span> <span class="na">decimal</span> <span class="err">(</span><span class="na">por</span> <span class="na">ejemplo</span> <span class="na">2</span> <span class="err">→</span> <span class="na">2</span><span class="err">.</span><span class="na">0</span><span class="err">)</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">Number</span><span class="err">.</span><span class="na">isInteger</span><span class="err">(</span><span class="na">timer</span><span class="err">))</span> <span class="err">{</span>
         <span class="na">timer </span><span class="o">=</span> <span class="s">timer.toFixed(1);</span>
      <span class="err">}</span>
      <span class="err">}</span>
   <span class="err">}</span>

   <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">avance_libre</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span> <span class="na">valor</span><span class="err">,</span> <span class="na">timer</span> <span class="err">}</span>
   <span class="err">});</span>
   <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

<span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">giro</span> <span class="na">libre</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">giro_libre</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
   <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;VALOR&quot;);</span>

   <span class="na">let</span> <span class="na">timer </span><span class="o">=</span> <span class="s">0;</span>
   <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;TIME&quot;);</span>
   <span class="na">if</span> <span class="err">(</span><span class="na">b</span> <span class="err">&amp;&amp;</span> <span class="na">b</span><span class="err">.</span><span class="na">type </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">math_number</span><span class="err">&#39;)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">raw </span><span class="o">=</span> <span class="s">b.getFieldValue(&#39;NUM&#39;);</span>
      <span class="na">const</span> <span class="na">num </span><span class="o">=</span> <span class="s">parseFloat(raw);</span>
      <span class="na">if</span> <span class="err">(!</span><span class="na">isNaN</span><span class="err">(</span><span class="na">num</span><span class="err">))</span> <span class="err">{</span>
      <span class="err">//</span> <span class="na">Redondear</span> <span class="na">a</span> <span class="na">máximo</span> <span class="na">3</span> <span class="na">decimales</span>
      <span class="na">timer </span><span class="o">=</span> <span class="s">Math.round(num</span> <span class="err">*</span> <span class="na">1000</span><span class="err">)</span> <span class="err">/</span> <span class="na">1000</span><span class="err">;</span>

      <span class="err">//</span> <span class="na">Asegurar</span> <span class="na">que</span> <span class="na">tenga</span> <span class="na">al</span> <span class="na">menos</span> <span class="na">1</span> <span class="na">decimal</span> <span class="err">(</span><span class="na">por</span> <span class="na">ejemplo</span> <span class="na">2</span> <span class="err">→</span> <span class="na">2</span><span class="err">.</span><span class="na">0</span><span class="err">)</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">Number</span><span class="err">.</span><span class="na">isInteger</span><span class="err">(</span><span class="na">timer</span><span class="err">))</span> <span class="err">{</span>
         <span class="na">timer </span><span class="o">=</span> <span class="s">timer.toFixed(1);</span>
      <span class="err">}</span>
      <span class="err">}</span>
   <span class="err">}</span>

   <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">giro_libre</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span> <span class="na">valor</span><span class="err">,</span> <span class="na">timer</span> <span class="err">}</span>
   <span class="err">});</span>
   <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

<span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">de</span> <span class="na">LED</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_led</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;LED&quot;);</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">LED</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span> <span class="na">valor</span> <span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>


<span class="err">//</span>  <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">Esperar</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_esperar</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>

   <span class="na">let</span> <span class="na">timer </span><span class="o">=</span> <span class="s">0;</span>
   <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;TIME&quot;);</span>
   <span class="na">if</span> <span class="err">(</span><span class="na">b</span> <span class="err">&amp;&amp;</span> <span class="na">b</span><span class="err">.</span><span class="na">type </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">math_number</span><span class="err">&#39;)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">raw </span><span class="o">=</span> <span class="s">b.getFieldValue(&#39;NUM&#39;);</span>
      <span class="na">const</span> <span class="na">num </span><span class="o">=</span> <span class="s">parseFloat(raw);</span>
      <span class="na">if</span> <span class="err">(!</span><span class="na">isNaN</span><span class="err">(</span><span class="na">num</span><span class="err">))</span> <span class="err">{</span>
      <span class="err">//</span> <span class="na">Redondear</span> <span class="na">a</span> <span class="na">máximo</span> <span class="na">3</span> <span class="na">decimales</span>
      <span class="na">timer </span><span class="o">=</span> <span class="s">Math.round(num</span> <span class="err">*</span> <span class="na">1000</span><span class="err">)</span> <span class="err">/</span> <span class="na">1000</span><span class="err">;</span>

      <span class="err">//</span> <span class="na">Asegurar</span> <span class="na">que</span> <span class="na">tenga</span> <span class="na">al</span> <span class="na">menos</span> <span class="na">1</span> <span class="na">decimal</span> <span class="err">(</span><span class="na">por</span> <span class="na">ejemplo</span> <span class="na">2</span> <span class="err">→</span> <span class="na">2</span><span class="err">.</span><span class="na">0</span><span class="err">)</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">Number</span><span class="err">.</span><span class="na">isInteger</span><span class="err">(</span><span class="na">timer</span><span class="err">))</span> <span class="err">{</span>
         <span class="na">timer </span><span class="o">=</span> <span class="s">timer.toFixed(1);</span>
      <span class="err">}</span>
      <span class="err">}</span>
   <span class="err">}</span>

   <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">esperar</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span><span class="na">timer</span><span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

<span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">velocidad</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_velocidad</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">let</span> <span class="na">porcentaje </span><span class="o">=</span> <span class="s">60;</span>
      <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;VELOCIDAD&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">b</span> <span class="err">&amp;&amp;</span> <span class="na">b</span><span class="err">.</span><span class="na">type </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">math_number</span><span class="err">&#39;)</span> <span class="na">porcentaje </span><span class="o">=</span> <span class="s">parseInt(b.getFieldValue(&#39;NUM&#39;))</span> <span class="err">||</span> <span class="na">60</span><span class="err">;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">set_velocidad</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span> <span class="na">porcentaje</span> <span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>



<span class="err">//</span> <span class="na">Generador</span> <span class="na">gripper</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_gripper</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;GRIPPER&quot;);</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">set_gripper</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span><span class="na">valor</span><span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>


<span class="err">//</span> <span class="na">--------------------------Generadores</span> <span class="na">de</span> <span class="na">variables</span> <span class="na">NUM</span><span class="err">,</span> <span class="na">TEXT</span> <span class="na">y</span> <span class="na">BOOL----------------</span>

   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">math_number</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">block </span><span class="o">=</span><span class="err">&gt; </span><span class="s">[block.getFieldValue(&#39;NUM&#39;),</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">text</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">block </span><span class="o">=</span><span class="err">&gt; </span><span class="s">[JSON.stringify(block.getFieldValue(&quot;TEXT&quot;)),</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">logic_boolean</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">block </span><span class="o">=</span><span class="err">&gt; </span><span class="s">[block.getFieldValue(&#39;BOOL&#39;),</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>


<span class="err">//</span> <span class="na">-----------------------</span>  <span class="na">Bloques</span> <span class="na">logicos</span> <span class="na">--------------------------------------------</span>

<span class="err">//</span> <span class="na">Generadores</span> <span class="na">codigo</span> <span class="na">logica</span> <span class="na">comparar</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">logic_compare</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">op </span><span class="o">=</span> <span class="s">block.getFieldValue(&#39;OP&#39;)</span> <span class="err">||</span> <span class="err">&#39;==&#39;;</span>
      <span class="na">let</span> <span class="na">izquierda </span><span class="o">=</span> <span class="s">&#39;0&#39;</span><span class="err">;</span>
      <span class="na">let</span> <span class="na">derecha </span><span class="o">=</span> <span class="s">&#39;0&#39;</span><span class="err">;</span>

      <span class="na">const</span> <span class="na">leftBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;A&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">leftBlock</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">leftCode </span><span class="o">=</span> <span class="s">jsonGen.blockToCode(leftBlock);</span>
      <span class="na">izquierda </span><span class="o">=</span> <span class="s">Array.isArray(leftCode)</span> <span class="err">?</span> <span class="na">leftCode</span><span class="err">[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="na">leftCode</span><span class="err">;</span>
      <span class="err">}</span>

      <span class="na">const</span> <span class="na">rightBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;B&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">rightBlock</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">rightCode </span><span class="o">=</span> <span class="s">jsonGen.blockToCode(rightBlock);</span>
      <span class="na">derecha </span><span class="o">=</span> <span class="s">Array.isArray(rightCode)</span> <span class="err">?</span> <span class="na">rightCode</span><span class="err">[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="na">rightCode</span><span class="err">;</span>
      <span class="err">}</span>

      <span class="na">const</span> <span class="na">resultado </span><span class="o">=</span> <span class="s">`(${izquierda}</span> <span class="err">${</span><span class="na">op</span><span class="err">}</span> <span class="err">${</span><span class="na">derecha</span><span class="err">})`;</span>
      <span class="na">console</span><span class="err">.</span><span class="na">log</span><span class="err">(&quot;✅</span> <span class="na">logic_compare:</span><span class="err">&quot;,</span> <span class="na">resultado</span><span class="err">);</span>
      <span class="na">return</span> <span class="err">[</span><span class="na">resultado</span><span class="err">,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">comparador</span> <span class="na">de</span> <span class="na">condicionales</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">logic_operation</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">a </span><span class="o">=</span> <span class="s">jsonGen.blockToCode(block.getInputTargetBlock(&quot;A&quot;))[0]</span> <span class="err">||</span> <span class="err">&#39;</span><span class="na">False</span><span class="err">&#39;;</span>
      <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">jsonGen.blockToCode(block.getInputTargetBlock(&quot;B&quot;))[0]</span> <span class="err">||</span> <span class="err">&#39;</span><span class="na">False</span><span class="err">&#39;;</span>
      <span class="na">const</span> <span class="na">op </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;OP&quot;)</span> <span class="err">===</span> <span class="err">&quot;</span><span class="na">AND</span><span class="err">&quot;</span> <span class="err">?</span> <span class="err">&quot;</span><span class="na">and</span><span class="err">&quot;</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">or</span><span class="err">&quot;;</span>
      <span class="na">return</span> <span class="err">[`(${</span><span class="na">a</span><span class="err">}</span> <span class="err">${</span><span class="na">op</span><span class="err">}</span> <span class="err">${</span><span class="na">b</span><span class="err">})`,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">if</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_if</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">exprBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;VAR&quot;);</span>
      <span class="na">let</span> <span class="na">exprCode </span><span class="o">=</span> <span class="s">exprBlock</span> <span class="err">?</span> <span class="err">(</span><span class="na">Array</span><span class="err">.</span><span class="na">isArray</span><span class="err">(</span><span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">exprBlock</span><span class="err">))</span> <span class="err">?</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">exprBlock</span><span class="err">)[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">False</span><span class="err">&quot;)</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">False</span><span class="err">&quot;;</span>
      <span class="na">const</span> <span class="na">outer </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">[];</span>
      <span class="na">const</span> <span class="na">inner </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;ENTONCES&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">inner</span><span class="err">)</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">inner</span><span class="err">);</span>
      <span class="na">const</span> <span class="na">acciones </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">outer;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span> <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">if</span><span class="err">&quot;,</span> <span class="na">expresion:</span> <span class="na">exprCode</span><span class="err">,</span> <span class="na">entonces:</span> <span class="na">acciones</span> <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">for</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_for</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">let</span> <span class="na">repeticiones </span><span class="o">=</span> <span class="s">1;</span>
      <span class="na">const</span> <span class="na">b </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;VECES&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">b</span> <span class="err">&amp;&amp;</span> <span class="na">b</span><span class="err">.</span><span class="na">type </span><span class="o">=</span><span class="s">==</span> <span class="err">&#39;</span><span class="na">math_number</span><span class="err">&#39;)</span> <span class="na">repeticiones </span><span class="o">=</span> <span class="s">parseInt(b.getFieldValue(&#39;NUM&#39;))</span> <span class="err">||</span> <span class="na">1</span><span class="err">;</span>

      <span class="na">const</span> <span class="na">outer </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">[];</span>
      <span class="na">const</span> <span class="na">inner </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;HACER&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">inner</span><span class="err">)</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">inner</span><span class="err">);</span>
      <span class="na">const</span> <span class="na">acciones </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">outer;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span> <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">for</span><span class="err">&quot;,</span> <span class="na">repeticiones</span><span class="err">,</span> <span class="na">hacer:</span> <span class="na">acciones</span> <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">bloque</span> <span class="na">If</span><span class="err">/</span> <span class="na">Else</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_if_else</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">exprBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;COND&quot;);</span>
      <span class="na">const</span> <span class="na">exprCode </span><span class="o">=</span> <span class="s">exprBlock</span> <span class="err">?</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">exprBlock</span><span class="err">)[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">False</span><span class="err">&quot;;</span>

      <span class="na">const</span> <span class="na">outer </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">[];</span>
      <span class="na">const</span> <span class="na">si </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;ENTONCES&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">si</span><span class="err">)</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">si</span><span class="err">);</span>
      <span class="na">const</span> <span class="na">entonces </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">[];</span>
      <span class="na">const</span> <span class="na">no </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;SINO&quot;);</span>
      <span class="na">if</span> <span class="err">(</span><span class="na">no</span><span class="err">)</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">no</span><span class="err">);</span>
      <span class="na">const</span> <span class="na">sino </span><span class="o">=</span> <span class="s">jsonGen.commands_;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_ </span><span class="o">=</span> <span class="s">outer;</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span> <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">if_else</span><span class="err">&quot;,</span> <span class="na">expresion:</span> <span class="na">exprCode</span><span class="err">,</span> <span class="na">entonces</span><span class="err">,</span> <span class="na">sino</span> <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>


   <span class="err">//</span>  <span class="na">Generador</span> <span class="na">Crear</span> <span class="na">variable</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">crear_variable</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">nombre </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;NOMBRE&quot;);</span>
      <span class="na">const</span> <span class="na">valorBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;VALOR&quot;);</span>
      <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">valorBlock</span> <span class="err">?</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">valorBlock</span><span class="err">,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">)[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">0</span><span class="err">&quot;;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">definir_variable</span><span class="err">&quot;,</span>
      <span class="na">nombre</span><span class="err">,</span>
      <span class="na">valor</span>
      <span class="err">});</span>

      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">set</span> <span class="na">veriuable</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">set_variable</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">nombre </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;NOMBRE&quot;);</span>
      <span class="na">const</span> <span class="na">valorBlock </span><span class="o">=</span> <span class="s">block.getInputTargetBlock(&quot;VALOR&quot;);</span>
      <span class="na">const</span> <span class="na">valor </span><span class="o">=</span> <span class="s">valorBlock</span> <span class="err">?</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">blockToCode</span><span class="err">(</span><span class="na">valorBlock</span><span class="err">,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">)[</span><span class="na">0</span><span class="err">]</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">0</span><span class="err">&quot;;</span>

      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">asignar_variable</span><span class="err">&quot;,</span>
      <span class="na">nombre</span><span class="err">,</span>
      <span class="na">valor</span>
      <span class="err">});</span>

      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">get</span> <span class="na">variable</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">get_variable</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">nombre </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;NOMBRE&quot;);</span>
      <span class="na">return</span> <span class="err">[</span><span class="na">nombre</span><span class="err">,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="err">};</span>

   <span class="err">//</span><span class="na">---------------------------------------Sensores-------------------------------</span>
   <span class="err">//</span> <span class="na">Generador</span> <span class="na">leer</span> <span class="na">sensor</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">bloque_leer_sensor</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">function</span><span class="err">(</span><span class="na">block</span><span class="err">)</span> <span class="err">{</span>
      <span class="na">const</span> <span class="na">nombre </span><span class="o">=</span> <span class="s">block.getFieldValue(&quot;SENSOR&quot;);</span>
      <span class="na">jsonGen</span><span class="err">.</span><span class="na">commands_</span><span class="err">.</span><span class="na">push</span><span class="err">({</span>
      <span class="na">accion:</span> <span class="err">&quot;</span><span class="na">leer_sensor</span><span class="err">&quot;,</span>
      <span class="na">mensaje:</span> <span class="err">{</span><span class="na">sensor:</span> <span class="na">nombre</span><span class="err">}</span>
      <span class="err">});</span>
      <span class="na">return</span> <span class="err">&#39;&#39;;</span>
   <span class="err">};</span>

   <span class="err">//</span> <span class="na">Generador</span> <span class="na">variable</span> <span class="na">de</span> <span class="na">sensor</span>
   <span class="na">jsonGen</span><span class="err">.</span><span class="na">forBlock</span><span class="err">[&#39;</span><span class="na">get_sensor</span><span class="err">&#39;]</span> <span class="err">=</span> <span class="na">block </span><span class="o">=</span><span class="err">&gt; </span><span class="s">{</span>
      <span class="na">const</span> <span class="na">nombre </span><span class="o">=</span> <span class="s">block.getFieldValue(&#39;NUM&#39;);</span>
      <span class="na">return</span> <span class="err">[</span><span class="na">nombre</span><span class="err">,</span> <span class="na">jsonGen</span><span class="err">.</span><span class="na">ORDER_ATOMIC</span><span class="err">];</span>
   <span class="err">};</span>
</pre></div>
</div>
</div></div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../tema_0/0_intro.html" class="btn btn-neutral float-left" title="Introduccion al Repositorio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../tema_2/0_electronica.html" class="btn btn-neutral float-right" title="Instalacion Arduino ID" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2025, AvigTech.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>